package main

import (
	"context"
	"log"
	"net/http"
	"runtime"
	"time"

	retrieve "github.com/Meesho/BharatMLStack/go-sdk/pkg/proto/onfs/retrieve" // adjust path
	"github.com/gin-gonic/gin"
	"google.golang.org/grpc"
	"google.golang.org/grpc/credentials/insecure"
	"google.golang.org/grpc/keepalive"
	"google.golang.org/grpc/metadata"
)

// AppState stores gRPC client
type AppState struct {
	client       retrieve.FeatureServiceClient
	entityLabel  string
	featureGroup *retrieve.FeatureGroup
	keysSchema   []string
	metadata     metadata.MD
}

func (s *AppState) handler(c *gin.Context) {
	ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)
	defer cancel()
	ctx = metadata.NewOutgoingContext(ctx, s.metadata)

	req := &retrieve.Query{
		EntityLabel: s.entityLabel,
		FeatureGroups: []*retrieve.FeatureGroup{
			s.featureGroup,
		},
		KeysSchema: s.keysSchema,
		Keys: []*retrieve.Keys{
			{Cols: []string{"176"}},
			{Cols: []string{"179"}},
		},
	}

	_, err := s.client.RetrieveFeatures(ctx, req)
	if err != nil {
		c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
		return
	}
	c.JSON(http.StatusOK, "success")
}

func getLabels() []string {
	return []string{
		"max_product_price_percentile",
		"orders_by_views_56day_percentile",
		"catalog__platform_orders_by_clicks_28_days_percentile_bin",
		"orders_by_views_28day_bin_percentile",
		"min_product_price_percentile",
		"orders_14day_percentile",
		"total_rated_orders_bin_percentile",
		"orders_28day_percentile",
		"clicks_by_views_1day_percentile",
		"min_product_price_bin_percentile",
		"clicks_by_views_3day_percentile",
		"log_orders_1day",
		"total_rated_orders_percentile",
		"clicks_by_views_5day",
		"views_56day_percentile",
		"log_clicks_7day",
		"views_3day_percentile",
		"orders_by_views_28day_percentile",
		"orders_7day_percentile",
		"orders_by_clicks_14day_percentile",
		"clicks_by_views_5day_percentile",
		"log_clicks_56day",
		"orders_by_clicks_28day_percentile",
		"orders_3day_percentile",
		"clicks_by_views_56day_percentile",
		"log_orders_14day",
		"log_views_5day",
		"max_product_price_percentile_bin",
		"log_clicks_3day",
		"views_7day_percentile",
		"orders_by_views_14day_percentile",
		"log_clicks_28day",
		"log_views_1day",
		"log_orders_7day",
		"clicks_by_views_1day__bin_percentile",
		"clicks_56day_percentile",
		"clicks_5day_percentile",
		"catalog__platform_orders_by_clicks_3_days",
		"orders_by_clicks_3day_percentile",
		"orders_by_clicks_1day_percentile",
		"orders_by_clicks_5day_percentile",
		"log_clicks_1day",
		"orders_by_clicks_7day_percentile",
		"log_orders_3day",
		"log_orders_56day",
		"clicks_7day_percentile",
		"orders_by_views_3day_percentile",
		"log_views_56day",
		"clicks_3day_percentile",
		"orders_by_views_7day_percentile",
		"clicks_1day_percentile",
		"orders_by_views_5day_percentile",
		"log_clicks_14day",
		"clicks_by_views_7day_percentile",
		"clicks_28day_percentile",
		"orders_5day_percentile",
		"orders_by_views_1day_percentile",
		"log_orders_28day",
		"clicks_by_views_28day_bin_percentile",
		"log_views_7day",
		"views_5day_percentile",
		"views_28day_percentile",
		"log_views_28day",
		"views_1day_percentile",
		"orders_1day_percentile",
		"log_views_3day",
		"orders_by_clicks_56day_percentile",
		"log_clicks_5day",
		"orders_56day_percentile",
		"clicks_by_views_14day_percentile",
		"clicks_by_views_28day_percentile",
		"ctr_bin_normalized_clicks_by_views_1_days",
		"sscat_normalized_clicks_by_views_1_days",
		"position_coec_7_days",
		"pdp__hour_coec_7_days",
		"hour_coec_1_days",
		"pdp__sscat_normalized_clicks_by_views_7_days",
		"search__clicks_by_views_1_days",
		"pdp__position_coec_7_days",
		"search__clicks_by_views_3_days",
		"hour_coec_30_days",
		"search__active_days_normalized_clicks_by_views_3_days",
		"pdp__clicks_by_views_7_days",
		"clicks_by_views_14_days",
		"hour_coec_14_days",
		"search__sscat_normalized_clicks_by_views_1_days",
		"search__hour_coec_1_days",
		"clicks_by_views_30_days",
		"position_coec_3_days",
		"search__active_days_normalized_clicks_by_views_1_days",
		"search__position_coec_7_days",
		"clicks_by_active_days_14_days",
		"search__clicks_by_active_days_7_days",
		"pdp__hour_coec_14_days",
		"search__active_days_normalized_clicks_by_views_7_days",
		"search__hour_coec_14_days",
		"hour_expected_clicks_1_days",
		"position_coec_14_days",
		"search__clicks_by_views_7_days",
		"search__hour_coec_3_days",
		"position_expected_clicks_1_days",
		"clicks_by_views_3_days",
		"pdp__sscat_normalized_clicks_by_views_30_days",
		"search__position_coec_30_days",
		"pdp__clicks_by_active_days_7_days",
		"search__position_coec_3_days",
		"search__active_days_normalized_clicks_by_views_14_days",
		"search__clicks_by_views_14_days",
		"pdp__clicks_by_views_1_days",
		"search__sscat_normalized_clicks_by_views_30_days",
		"pdp__clicks_by_views_14_days",
		"hour_coec_7_days",
		"pdp__hour_coec_30_days",
		"search__hour_coec_7_days",
		"search__sscat_normalized_clicks_by_views_7_days",
		"sscat_normalized_clicks_by_views_7_days",
		"pdp__clicks_by_views_3_days",
		"search__position_coec_1_days",
		"search__sscat_normalized_clicks_by_views_14_days",
		"search__clicks_by_views_30_days",
		"clicks_by_views_1_days",
		"pdp__position_coec_30_days",
		"clicks_by_views_7_days",
		"position_coec_1_days",
		"pdp__hour_coec_1_days",
		"search__hour_coec_30_days",
		"sscat_normalized_clicks_by_views_30_days",
		"search__sscat_normalized_clicks_by_views_3_days",
		"position_coec_30_days",
		"pdp__clicks_by_views_30_days",
		"orders_by_clicks_laplace_28day",
		"clicks_by_views_laplace_7day",
		"orders_by_views_laplace_1day",
		"clicks_by_views_laplace_3day",
		"clicks_by_views_laplace_56day",
		"catalog__ads_orders_by_clicks_14_days__te_laplace",
		"orders_by_clicks_laplace_3day",
		"orders_by_views_laplace_28day",
		"orders_by_clicks_laplace_56day",
		"orders_by_clicks_laplace_7day",
		"orders_by_views_laplace_5day",
		"clicks_by_views_laplace_5day",
		"orders_by_views_laplace_3day",
		"orders_by_views_laplace_56day",
		"catalog__ads_orders_by_views_14_days__te_laplace",
		"orders_by_clicks_laplace_5day",
		"clicks_by_views_laplace_1day",
		"orders_by_clicks_laplace_1day",
		"orders_by_views_laplace_7day",
		"clicks_by_views_laplace_28day",
		"laplace_cbyv_by_platform_cbyv_7day",
		"laplace_cbyv_by_platform_cbyv_56day",
		"laplace_obyv_by_platform_obyv_1day",
		"laplace_cbyv_by_platform_cbyv_3day",
		"laplace_obyv_by_platform_obyv_56day",
		"laplace_obyc_by_platform_obyc_56day",
		"laplace_obyc_by_platform_obyc_7day",
		"laplace_obyv_by_platform_obyv_5day",
		"laplace_obyc_by_platform_obyc_3day",
		"laplace_obyc_by_platform_obyc_28day",
		"laplace_obyv_by_platform_obyv_28day",
		"laplace_cbyv_by_platform_cbyv_5day",
		"laplace_obyc_by_platform_obyc_5day",
		"laplace_cbyv_by_platform_cbyv_1day",
		"laplace_cbyv_by_platform_cbyv_28day",
		"laplace_obyv_by_platform_obyv_3day",
		"catalog__base_cpc",
		"laplace_obyv_by_platform_obyv_7day",
		"laplace_obyc_by_platform_obyc_1day",
		"orders_by_views_3_days_percentile",
		"views_7_days_percentile",
		"orders_by_clicks_56_days_percentile",
		"orders_by_clicks_5_days_percentile",
		"clicks_by_views_28_days_percentile",
		"orders_1_days__te_log",
		"search__orders_by_views_3_days_percentile",
		"orders_3_days__te_log",
		"orders_1_days_percentile",
		"orders_7_days_percentile",
		"orders_7_days__te_log",
		"search__orders_by_clicks_3_days_percentile",
		"search__clicks_by_views_1_days_percentile_bin",
		"search__clicks_56_days_percentile",
		"search__orders_by_views_28_days_percentile_bin",
		"orders_by_views_7_days_percentile_bin",
		"orders_by_clicks_3_days_percentile",
		"search__clicks_by_views_1_days_percentile",
		"search__orders_by_clicks_1_days_percentile_bin",
		"orders_by_views_14_days_percentile",
		"search__orders_by_views_28_days_percentile",
		"search__orders_by_views_56_days_percentile_bin",
		"orders_by_views_1_days_percentile",
		"orders_by_clicks_14_days_percentile",
		"search__orders_by_views_14_days_percentile",
		"search__orders_by_views_1_days_percentile",
		"clicks_by_views_14_days_percentile",
		"search__orders_by_views_5_days_percentile_bin",
		"clicks_3_days_percentile",
		"clicks_by_views_3_days_percentile",
		"orders_by_clicks_28_days_percentile",
		"search__orders_by_clicks_56_days_percentile",
		"search__clicks_by_views_28_days_percentile",
		"search__orders_by_clicks_7_days_percentile_bin",
		"search__clicks_by_views_14_days_percentile_bin",
		"orders_by_clicks_7_days",
		"orders_by_clicks_3_days_percentile_bin",
		"orders_by_views_3_days_percentile_bin",
		"views_28_days_percentile",
		"clicks_by_views_7_days_percentile",
		"clicks_by_views_1_days_percentile",
		"clicks_56_days__te_log",
		"orders_by_views_28_days_percentile",
		"search__orders_by_clicks_7_days_percentile",
		"search__orders_by_clicks_1_days_percentile",
		"orders_by_clicks_1_days_percentile",
		"orders_by_clicks_7_days_percentile",
		"orders_by_views_5_days_percentile",
		"search__orders_by_views_14_days_percentile_bin",
		"search__orders_by_clicks_3_days_percentile_bin",
		"search__orders_by_views_5_days_percentile",
		"clicks_7_days_percentile",
		"views_56_days_percentile_bin",
		"orders_by_clicks_7_days_percentile_bin",
		"search__orders_1_days_percentile",
		"clicks_28_days__te_log",
		"orders_by_views_56_days_percentile",
		"orders_by_clicks_1_days_percentile_bin",
		"search__orders_by_views_56_days_percentile",
		"views_3_days_percentile",
		"orders_by_views_7_days_percentile",
		"search__orders_by_views_7_days_percentile",
		"clicks_28_days_percentile",
		"search__orders_by_views_1_days_percentile_bin",
		"orders_3_days_percentile",
		"orders_28_days_percentile",
		"clicks_by_views_56_days_percentile",
		"num_rating_3_By_num_rating",
		"qr_orders_by_sub_orders_28day",
		"num_rating_4_By_num_rating",
		"catalog__nqd_28_days",
		"catalog__num_rating_3_By_num_rating_56_days",
		"rtos_by_net_orders",
		"nqp_28day",
		"net_orders_by_gross_orders_28day",
		"catalog__qr_orders_By_return_orders_90_days",
		"rating_avg",
		"rtos_by_gross_orders",
		"net_orders_by_gross_orders_90day",
		"num_review_By_num_rating",
		"catalog__wfr_orders_By_return_orders",
		"catalog__num_rating_3_By_num_rating_90_days",
		"catalog__mean_price_90_days",
		"rtos_by_net_orders_90day",
		"catalog__num_rating_3_By_num_rating_28_days",
		"num_img_review_by_num_review",
		"avg_ratings_7day",
		"num_review_By_num_rating_7day",
		"nqp_by_nqd_90day",
		"nqp",
		"nqd",
		"catalog__avg_ratings_28_days",
		"net_orders_by_gross_orders_56day",
		"catalog__nqp_90_days",
		"user_cancelled_by_net_orders_7day",
		"return_orders_by_sub_orders",
		"cancellations_by_gross_orders_90day",
		"cancellations_by_net_orders_7day",
		"qr_orders_by_sub_orders",
		"catalog__total_helpful_review_By_num_review",
		"catalog__total_o2d_delay_By_total_orders_28_days",
		"return_orders_by_sub_orders_90day",
		"nqp_By_nqd_7day",
		"nqp_by_nqd_28day",
		"catalog__user_cancelled_By_net_orders",
		"cancellations_by_net_orders_56day",
		"catalog__num_rating_4_By_num_rating_7_days",
		"catalog__net_orders_By_gross_orders_7_days",
		"rtos_by_gross_orders_28day",
		"avg_ratings_56day",
		"total_s2d_delay_by_total_orders_28day",
		"nqp_by_nqd",
		"num_rating_5_by_num_rating",
		"count_reviews_with_helpful_by_num_review_28day",
		"rtos_by_gross_orders_56day",
		"user_cancelled_by_net_orders_28day",
		"catalog__return_orders_By_sub_orders_28_days",
		"wfr_orders_by_sub_orders",
		"num_review_by_num_rating_28day",
		"wfr_orders_by_sub_orders_28day",
		"num_review_by_num_rating_90day",
		"catalog__num_rating_1_By_num_rating_5_56_days",
		"catalog__num_rating_3_By_num_rating_7_days",
		"nqp_7day",
		"sscat_standardized_cat_predicted_nqd_wd_sigmoid",
		"net_orders_by_gross_orders",
		"cancellations_by_net_orders",
		"return_orders_by_sub_orders_56day",
		"cancellations_by_gross_orders",
		"catalog__rtos_By_gross_orders_7_days",
		"catalog__total_o2d_delay_By_total_orders",
		"catalog__total_o2s_delayed_orders_By_total_orders_56_days",
		"catalog__nqd_7_days",
		"catalog__num_rating_5_By_num_rating_7_days",
		"user_cancelled_by_net_orders_56day",
		"cancellations_by_net_orders_28day",
		"sscat__price_asp",
		"asp_sscat_percentile",
		"price_shipping_percent",
		"price_cheapest_duplicate_diff_percent",
		"sscat_asp_price_arp_diff_percent",
		"price_wdrp_depth_percent",
		"price_sscat_percentile",
		"price_decrease_percent_decay",
		"arp_sscat_percentile",
		"price_discount_percent",
		"catalog__price_decrease_pct",
		"mrp_sscat_percentile",
		"price_increase_percent_decay",
		"sscat_asp_price_arp_diff",
		"price_discount",
		"catalog__user_risk_weighted_orders_90_days",
		"od_between_25p_to_50p_user_api_user_orders_percentage_90day",
		"high_risk_user_orders_percentage",
		"od_less_than_25p_user_api_user_orders_percentage_90day",
		"od_2_4_order_users_orders_percentage_90day",
		"od_more_than_75p_user_aov_user_orders_percentage_90day",
		"od_20_plus_order_users_orders_percentage_90day",
		"avg_orders_weighted_aov_90day",
		"low_risk_user_orders_percentage",
		"od_5_10_order_users_orders_percentage",
		"od_2_4_order_users_orders_percentage",
		"low_risk_user_orders_percentage_90day",
		"od_10_20_order_users_orders_percentage",
		"catalog__between_50p_to_75p_user_aov_user_orders_percentage_90_days",
		"od_0_1_order_users_orders_percentage_90day",
		"avg_orders_weighted_api_90day",
		"od_less_than_25p_user_aov_user_orders_percentage_90day",
		"od_0_1_order_users_orders_percentage",
		"od_5_10_order_users_orders_percentage_90day",
		"od_between_25p_to_50p_user_aov_user_orders_percentage_90day",
		"od_more_than_75p_user_api_user_orders_percentage_90day",
		"od_between_50p_to_75p_user_api_user_orders_percentage_90day",
		"catalog__high_risk_user_orders_percentage_90_days",
		"od_20_plus_order_users_orders_percentage",
		"catalog__10_20_order_users_orders_percentage_90_days",
		"catalog__ads_clicks_by_views_56_days_percentile",
		"catalog__ads_orders_by_views_1_days_percentile_bin",
		"catalog__ads_orders_by_views_56_days_percentile_bin",
		"catalog__ads_clicks_by_views_28_days_percentile",
		"catalog__ads_orders_by_views_14_days_percentile_bin",
		"clicks_28day_percentile",
		"catalog__ads_orders_by_views_3_days_percentile",
		"catalog__ads_clicks_by_views_28_days_percentile_bin",
		"catalog__ads_orders_by_clicks_5_days_percentile",
		"orders_56day_percentile",
		"catalog__ads_orders_14_days_percentile",
		"clicks_56day_percentile",
		"catalog__ads_clicks_by_views_5_days",
		"catalog__ads_orders_by_views_7_days_percentile",
		"views_1day_percentile",
		"catalog__ads_orders_by_clicks_28_days_percentile_bin",
		"catalog__ads_orders_by_clicks_7_days_percentile_bin",
		"catalog__ads_orders_by_views_56_days_percentile",
		"clicks_7day_percentile",
		"catalog__ads_orders_by_views_7_days_percentile_bin",
		"clicks_3day_percentile",
		"catalog__ads_orders_by_views_28_days_percentile_bin",
		"catalog__ads_orders_by_clicks_1_days_percentile_bin",
		"views_56day_percentile",
		"catalog__ads_orders_by_clicks_56_days_percentile_bin",
		"views_5day_percentile",
		"catalog__ads_clicks_by_views_3_days_percentile_bin",
		"catalog__ads_orders_by_clicks_7_days_percentile",
		"catalog__ads_orders_by_views_28_days_percentile",
		"catalog__ads_clicks_by_views_7_days_percentile",
		"catalog__ads_orders_by_clicks_3_days_percentile",
		"catalog__ads_clicks_by_views_1_days_percentile",
		"catalog__ads_orders_by_clicks_3_days_percentile_bin",
		"catalog__ads_orders_by_clicks_56_days_percentile",
		"catalog__ads_orders_by_clicks_28_days_percentile",
		"catalog__ads_orders_by_clicks_14_days",
		"catalog__ads_clicks_by_views_14_days_percentile_bin",
		"orders_3day_percentile",
		"catalog__ads_orders_by_clicks_14_days_percentile",
		"orders_1day_percentile",
		"views_28day_percentile",
		"catalog__ads_clicks_by_views_1_days_percentile_bin",
		"orders_5day_percentile",
		"catalog__ads_clicks_by_views_5_days_percentile_bin",
		"orders_28day_percentile",
		"catalog__ads_orders_by_views_5_days_percentile",
		"orders_7day_percentile",
		"catalog__ads_orders_by_views_5_days_percentile_bin",
		"catalog__ads_orders_by_views_1_days_percentile",
		"catalog__ads_clicks_by_views_56_days_percentile_bin",
		"catalog__ads_clicks_by_views_14_days_percentile",
		"catalog__ads_orders_by_views_14_days_percentile",
		"views_3day_percentile",
		"clicks_5day_percentile",
		"catalog__ads_clicks_by_views_56_days",
		"catalog__ads_clicks_by_views_5_days_percentile",
		"catalog__ads_orders_by_views_3_days_percentile_bin",
		"clicks_1day_percentile",
		"views_7day_percentile",
		"catalog__ads_orders_by_clicks_5_days_percentile_bin",
		"catalog__ads_clicks_by_views_3_days_percentile",
		"catalog__ads_clicks_by_views_7_days_percentile_bin",
		"catalog__ads_orders_by_clicks_1_days_percentile",
		"catalog__ads_orders_by_clicks_14_days_percentile_bin",
		"search__orders_by_views_7_days_percentile",
		"search__orders_by_clicks_1_days_percentile_bin",
		"search__orders_by_views_1_days_percentile",
		"search__orders_by_views_28_days_percentile_bin",
		"search__clicks_by_views_3_days_percentile",
		"search__orders_by_clicks_7_days_percentile",
		"search__orders_by_views_5_days_percentile_bin",
		"search__orders_by_views_14_days_percentile_bin",
		"search__orders_by_clicks_7_days_percentile_bin",
		"search__orders_by_views_3_days_percentile",
		"search__clicks_by_views_14_days_percentile_bin",
		"search__clicks_by_views_14_days_percentile",
		"search__orders_by_views_5_days_percentile",
		"search__clicks_by_views_28_days_percentile",
		"search__clicks_by_views_1_days_percentile_bin",
		"search__orders_by_views_14_days_percentile",
		"log_reviews",
		"price_change_percent_dec",
		"rating_30day",
		"price_change_percent_inc",
		"cancel_percent",
		"price_diff_with_p70",
		"rating_90day",
		"asp",
		"final_nqd",
		"diff_bw_asp_and_arp",
		"avg_rating",
		"rto_percent",
		"return_percent",
		"odnr_score",
		"rating_60day",
		"sscat_price_clicks_by_views_56day_percentile_bin_percentage",
		"sscat_rating_orders_by_views_56day_percentile_bin_percentage",
		"rating_orders_56day_percentile",
		"sscat_rating_clicks_by_views_56day_percentile_bin_percentage",
		"rating_views_56day_percentile",
		"sscat_price_orders_by_views_56day_percentile_bin_percentage",
		"catalog_rating",
		"sscat_price_orders_by_clicks_56day_percentile_bin_percentage",
		"price_clicks_56day_percentile",
		"price_orders_56day_percentile",
		"sscat_rating_orders_by_clicks_56day_percentile_bin_percentage",
		"price_views_56day_percentile",
		"rating_clicks_56day_percentile",
		"catalog__platform_orders_by_views_14_days__te_laplace",
		"orders_by_clicks_laplace_1day",
		"orders_by_views_laplace_28day",
		"orders_by_views_laplace_7day",
		"orders_by_views_laplace_3day",
		"orders_by_clicks_laplace_5day",
		"clicks_by_views_laplace_1day",
		"clicks_by_views_laplace_5day",
		"orders_by_views_laplace_56day",
		"orders_by_clicks_laplace_28day",
		"orders_by_clicks_laplace_3day",
		"orders_by_views_laplace_1day",
		"clicks_by_views_laplace_7day",
		"clicks_by_views_laplace_28day",
		"orders_by_clicks_laplace_56day",
		"orders_by_clicks_laplace_7day",
		"orders_by_views_laplace_5day",
		"clicks_by_views_laplace_56day",
		"clicks_by_views_laplace_3day",
		"catalog__platform_carts_3_days__te_log",
		"catalog__platform_carts_1_days__te_log",
		"catalog__platform_carts_14_days__te_log",
		"catalog__no_by_go_56_days",
		"gross_orders",
		"net_orders",
		"catalog__per_return",
		"cancellations",
		"catalog__nqd_56_days",
		"catalog__nqd_90_days",
		"catalog__per_qr_return",
		"catalog__avg_rating",
		"catalog__no_by_go_7_days",
		"catalog__no_by_go_28_days",
		"catalog__no_by_go_90_days",
		"search__sale_discount_factor_1",
		"search__sale_discount_factor_2",
		"clp__sale_discount_factor_2",
		"clp__sale_discount_factor_1",
		"pdp__sale_discount_factor_2",
		"pdp__sale_discount_factor_1",
		"ads_predicted_obyc_new_catalogs",
		"ads_ds_predicted_target_roi_v1",
		"ads_product_predicted_target_roi_v1",
		"shipped_rto_rate_6m",
		"shipped_rto_rate_3m",
		"rate_6m",
		"rate_6m",
		"rate_3m",
		"catalog__search_orders_by_clicks_28_days_percentile",
		"catalog__search_clicks_by_views_28_days_percentile",
		"catalog__search_views_3_days__te_log",
		"predicted_net_orders_by_gross_orders",
		"predicted_net_orders_by_gross_orders_smoothened_calibrated",
		"predicted_net_orders_by_gross_orders_smoothened",
		"views_3day",
		"views_28day",
		"orders_28day",
		"clicks_5day",
		"te_cbyv_7day",
		"te_obyv_7day",
		"te_obyv_3day",
		"orders_5day",
		"te_obyv_3day",
		"te_obyc_7day",
		"clicks_28day",
		"clicks_1day",
		"te_cbyv_3day",
		"te_obyc_28day",
		"te_cbyv_3day",
		"clicks_56day",
		"orders_56day",
		"views_56",
		"te_cbyv_56",
		"rated_orders_sscat_percentile",
		"views_7day",
		"rated_orders_sscat_percentile_bin",
		"orders_1day",
		"views_56day",
		"orders_1day",
		"clicks_28day",
		"te_cbyv_28day",
		"orders_5day",
		"max_price_sscat_percentile",
		"te_obyc_56day",
		"clicks_1day",
		"rating",
		"te_cbyv_28day",
		"clicks_5day",
		"te_obyc_56",
		"te_obyv_56day",
		"views_28day",
		"views_1day",
		"clicks_56day",
		"te_obyc_5day",
		"te_obyv_56",
		"te_obyc_28day",
		"te_cbyv_56",
		"te_cbyv_56day",
		"views_7day",
		"te_obyc_3day",
		"te_obyc_1day",
		"max_price_sscat_percentile_bin",
		"orders_56",
		"te_cbyv_7day",
		"clicks_7day",
		"te_obyv_5day",
		"orders_3day",
		"te_obyv_1day",
		"te_cbyv_5day",
		"views_1day",
		"te_cbyv_5day",
		"te_cbyv_1day",
		"min_price_sscat_percentile_bin",
		"views_5day",
		"clicks_3day",
		"te_obyc_56",
		"orders_56",
		"orders_7day",
		"te_obyv_5day",
		"min_price_sscat_percentile",
		"te_obyv_1day",
		"te_obyv_56",
		"te_cbyv_1day",
		"clicks_56",
		"te_obyv_56day",
		"te_obyv_28day",
		"te_obyv_28day",
		"views_56day",
		"clicks_56",
		"views_5day",
		"orders_28day",
		"views_3day",
		"views_56",
		"te_obyc_3day",
		"orders_3day",
		"te_obyc_7day",
		"orders_7day",
		"te_cbyv_56day",
		"clicks_3day",
		"orders_56day",
		"te_obyv_7day",
		"te_obyc_5day",
		"clicks_7day",
		"te_obyc_1day",
		"te_obyc_56day",
		"log_28day",
		"log_28day",
		"laplace_1day",
		"rating_30day",
		"diff_asp_arp",
		"laplace_7day",
		"laplace_28day",
		"log_7day",
		"log_1day",
		"28day",
		"log_7day",
		"rating_60day",
		"log_1day",
		"laplace_14day",
		"log_7day",
		"log_14day",
		"log_28day",
		"log_28day",
		"log_14day",
		"log_1day",
		"56day",
		"laplace_14day",
		"laplace_7day",
		"log_7day",
		"laplace_1day",
		"rating_90day",
		"asp",
		"laplace_28day",
		"nqd_boosting_factor_gbm_model_v1",
		"nqd_boosting_factor_gbm_model_v0",
		"clp_price_aov_boosting_factor_var2",
		"clp_price_aov_boosting_factor_var1",
		"clp_price_aov_boosting_factor_var4",
		"clp_price_aov_boosting_factor_var3",
		"loyalty_boosting_factor",
		"asp_p70_adj_30day",
		"arp_p70_adj_30day",
		"orders_by_clicks_bayesian",
		"clicks_by_views_bayesian",
		"orders_by_views_bayesian",
		"orders_by_views_28day",
		"clicks_by_views_28day",
		"clicks_by_views_7day",
		"orders_by_clicks_28day",
		"clicks_by_views_3day",
		"clicks_by_views_1day",
		"clicks_by_views_14day",
		"orders_by_views_1day",
		"clp_odnr_sale_boosting_factor",
		"net_order_by_gross_order",
		"net_order_by_gross_order_smoothened",
		"clp_odnr_sale_boosting_factor_var2",
		"scaledup_boosting_factor",
		"vrs_boosting_factor",
		"nqd_boosting_factor_analytical_v2",
		"search_odnr_sale_boosting_factor",
		"nqd_boosting_factor",
	}
}

func main() {
	runtime.GOMAXPROCS(4)
	gin.SetMode(gin.ReleaseMode)

	conn, err := grpc.Dial(
		"online-feature-store-api.int.meesho.int:80",
		grpc.WithTransportCredentials(insecure.NewCredentials()),
		grpc.WithKeepaliveParams(keepalive.ClientParameters{
			Time:                30 * time.Second,
			Timeout:             10 * time.Second,
			PermitWithoutStream: true,
		}),
	)
	if err != nil {
		log.Fatal(err)
	}

	featureGroup := &retrieve.FeatureGroup{
		Label:         "derived_fp32",
		FeatureLabels: getLabels(),
	}

	state := &AppState{
		client:       retrieve.NewFeatureServiceClient(conn),
		entityLabel:  "catalog",
		featureGroup: featureGroup,
		keysSchema:   []string{"catalog_id"},
		metadata: metadata.MD{
			"online-feature-store-auth-token": []string{"atishay"},
			"online-feature-store-caller-id":  []string{"test-3"},
		},
	}

	r := gin.New()
	r.POST("/retrieve-features", state.handler)

	log.Println("ðŸš€ Go gRPC Client running on http://0.0.0.0:8081")
	r.Run(":8081")
}
