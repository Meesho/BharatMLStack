# Default values for skye-consumers helm chart

namespace: prd-skye-consumers
applicationName: skye-consumers
replicaCount: 2

labels:
  env: prd
  team: bharatml
  bu: ml
  priority: p1
  priority_v2: cp3
  service_type: ""

priorityClassName: ""

telegraf:
  enabled: false

otel_enabled: false

infrastructure:
  secretStore:
    name: vault-backend
    kind: ClusterSecretStore
  vault:
    basePath: ""
    otelTokenPath: ""

deployment:
  enabled: true
  replicaCount: 2
  revisionHistoryLimit: 3
  image:
    repository: ghcr.io/meesho/skye-consumers
    tag: latest
    pullPolicy: IfNotPresent
  ports:
    - containerPort: 8093
      name: http
      protocol: TCP
  probes:
    liveness:
      path: /health
      port: 8093
      scheme: HTTP
      initialDelaySeconds: 30
      periodSeconds: 10
      failureThreshold: 3
      successThreshold: 1
      timeoutSeconds: 5
    readiness:
      path: /health
      port: 8093
      scheme: HTTP
      initialDelaySeconds: 20
      periodSeconds: 10
      failureThreshold: 3
      successThreshold: 1
      timeoutSeconds: 5
  resources:
    requests:
      memory: "512Mi"
      cpu: "250m"
    limits:
      memory: "1Gi"
      cpu: "1000m"
  env:
    - name: APP_NAME
      value: "skye"
    - name: APP_ENV
      value: "local"
    - name: APP_LOG_LEVEL
      value: "INFO"
    - name: APP_METRIC_SAMPLING_RATE
      value: "100"
    - name: PORT
      value: "8093"
    # Etcd
    - name: ETCD_SERVER
      value: "etcd:2379"
    - name: ETCD_WATCHER_ENABLED
      value: "true"
    # Embedding consumer (ID=2)
    - name: EMBEDDING_CONSUMER_KAFKA_IDS
      value: "2"
    - name: KAFKA_2_TOPICS
      value: "skye.embedding"
    - name: KAFKA_2_BOOTSTRAP_SERVERS
      value: "broker:29092"
    - name: KAFKA_2_BASIC_AUTH_CREDENTIAL_SOURCE
      value: "NONE"
    - name: KAFKA_2_GROUP_ID
      value: "skye-embedding-consumer"
    - name: KAFKA_2_AUTO_OFFSET_RESET
      value: "earliest"
    - name: KAFKA_2_AUTO_COMMIT_INTERVAL_MS
      value: "5000"
    - name: KAFKA_2_ENABLE_AUTO_COMMIT
      value: "false"
    - name: KAFKA_2_LISTENER_CONCURRENCY
      value: "1"
    - name: KAFKA_2_CLIENT_ID
      value: "skye-embedding-consumer"
    - name: KAFKA_2_BATCH_SIZE
      value: "10"
    - name: KAFKA_2_POLL_TIMEOUT
      value: "1000"
    # Embedding sequence consumer (ID=3)
    - name: EMBEDDING_CONSUMER_SEQUENCE_KAFKA_IDS
      value: "3"
    - name: KAFKA_3_TOPICS
      value: "skye.embedding-sequence"
    - name: KAFKA_3_BOOTSTRAP_SERVERS
      value: "broker:29092"
    - name: KAFKA_3_BASIC_AUTH_CREDENTIAL_SOURCE
      value: "NONE"
    - name: KAFKA_3_GROUP_ID
      value: "skye-embedding-seq-consumer"
    - name: KAFKA_3_AUTO_OFFSET_RESET
      value: "earliest"
    - name: KAFKA_3_AUTO_COMMIT_INTERVAL_MS
      value: "5000"
    - name: KAFKA_3_ENABLE_AUTO_COMMIT
      value: "false"
    - name: KAFKA_3_LISTENER_CONCURRENCY
      value: "1"
    - name: KAFKA_3_CLIENT_ID
      value: "skye-embedding-seq-consumer"
    - name: KAFKA_3_BATCH_SIZE
      value: "10"
    - name: KAFKA_3_POLL_TIMEOUT
      value: "1000"
    # Realtime consumer (ID=4)
    - name: REALTIME_CONSUMER_KAFKA_IDS
      value: "4"
    - name: KAFKA_4_TOPICS
      value: "skye.realtime"
    - name: KAFKA_4_BOOTSTRAP_SERVERS
      value: "broker:29092"
    - name: KAFKA_4_BASIC_AUTH_CREDENTIAL_SOURCE
      value: "NONE"
    - name: KAFKA_4_GROUP_ID
      value: "skye-realtime-consumer"
    - name: KAFKA_4_AUTO_OFFSET_RESET
      value: "earliest"
    - name: KAFKA_4_AUTO_COMMIT_INTERVAL_MS
      value: "5000"
    - name: KAFKA_4_ENABLE_AUTO_COMMIT
      value: "false"
    - name: KAFKA_4_LISTENER_CONCURRENCY
      value: "1"
    - name: KAFKA_4_CLIENT_ID
      value: "skye-realtime-consumer"
    - name: KAFKA_4_BATCH_SIZE
      value: "10"
    - name: KAFKA_4_POLL_TIMEOUT
      value: "1000"
    # Realtime producer (ID=5)
    - name: REALTIME_PRODUCER_KAFKA_ID
      value: "5"
    - name: KAFKA_PRODUCER_5_TOPICS
      value: "skye.realtime"
    - name: KAFKA_PRODUCER_5_BOOTSTRAP_SERVERS
      value: "broker:29092"
    - name: KAFKA_PRODUCER_5_CLIENT_ID
      value: "skye-realtime-producer"
    # Realtime delta producer (ID=6)
    - name: REALTIME_DELTA_PRODUCER_KAFKA_ID
      value: "6"
    - name: KAFKA_PRODUCER_6_TOPICS
      value: "skye.realtime-delta"
    - name: KAFKA_PRODUCER_6_BOOTSTRAP_SERVERS
      value: "broker:29092"
    - name: KAFKA_PRODUCER_6_CLIENT_ID
      value: "skye-realtime-delta-producer"
    # Realtime delta consumer (ID=7)
    - name: REALTIME_DELTA_CONSUMER_KAFKA_ID
      value: "7"
    - name: KAFKA_7_TOPICS
      value: "skye.realtime-delta"
    - name: KAFKA_7_BOOTSTRAP_SERVERS
      value: "broker:29092"
    - name: KAFKA_7_BASIC_AUTH_CREDENTIAL_SOURCE
      value: "NONE"
    - name: KAFKA_7_GROUP_ID
      value: "skye-realtime-delta-consumer"
    - name: KAFKA_7_AUTO_OFFSET_RESET
      value: "earliest"
    - name: KAFKA_7_AUTO_COMMIT_INTERVAL_MS
      value: "5000"
    - name: KAFKA_7_ENABLE_AUTO_COMMIT
      value: "false"
    - name: KAFKA_7_LISTENER_CONCURRENCY
      value: "1"
    - name: KAFKA_7_CLIENT_ID
      value: "skye-realtime-delta-consumer"
    - name: KAFKA_7_BATCH_SIZE
      value: "10"
    - name: KAFKA_7_POLL_TIMEOUT
      value: "1000"
  serviceAccount:
    enabled: false
    annotations: {}
  updateStrategy:
    strategy:
      type: RollingUpdate
      rollingUpdate:
        maxUnavailable: 0
        maxSurge: 1
  terminationGracePeriodSeconds: 30

service:
  enabled: true
  type: ClusterIP
  ports:
    - name: http
      port: 80
      targetPort: 8093
      protocol: TCP

autoscaling:
  enabled: false
  minReplicas: 2
  maxReplicas: 10
  pollingInterval: 30
  scaledown:
    stabilizationWindowSeconds: 300
    policies:
      - type: Percent
        value: 10
        periodseconds: 60
    selectpolicy: Min
  scaleup:
    stabilizationWindowSeconds: 0
    policies:
      - type: Percent
        value: 50
        periodseconds: 60
    selectpolicy: Max
  triggers:
    - type: cpu
      metadata:
        value: "70"
      metricType: Utilization

ingress:
  enabled: false
  ingressClassName: contour-internal
createContourGateway: false

externalSecret:
  enabled: false
  path: ""

configMap:
  enabled: false

canary:
  enabled: false
  promURL: ""
  slackChannel: ""
  slackWebhookURL: ""

podDisruptionBudget:
  enabled: false
  maxUnavailable: "10%"

disasterRecovery:
  enabled: false
