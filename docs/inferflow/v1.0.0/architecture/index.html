<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-inferflow/v1.0.0/architecture" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Architecture | BharatMLStack</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://meesho.github.io/BharatMLStack/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://meesho.github.io/BharatMLStack/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://meesho.github.io/BharatMLStack/inferflow/v1.0.0/architecture"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Architecture | BharatMLStack"><meta data-rh="true" name="description" content="Inferflow is part of BharatMLStack, a graph-driven feature retrieval and model inference orchestration engine built in Go. It eliminates the need for custom feature retrieval code by using configurable DAG topologies to dynamically resolve entity relationships, fetch features from the Online Feature Store, and orchestrate model scoring — all driven by configuration stored in etcd."><meta data-rh="true" property="og:description" content="Inferflow is part of BharatMLStack, a graph-driven feature retrieval and model inference orchestration engine built in Go. It eliminates the need for custom feature retrieval code by using configurable DAG topologies to dynamically resolve entity relationships, fetch features from the Online Feature Store, and orchestrate model scoring — all driven by configuration stored in etcd."><link data-rh="true" rel="icon" href="/BharatMLStack/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://meesho.github.io/BharatMLStack/inferflow/v1.0.0/architecture"><link data-rh="true" rel="alternate" href="https://meesho.github.io/BharatMLStack/inferflow/v1.0.0/architecture" hreflang="en"><link data-rh="true" rel="alternate" href="https://meesho.github.io/BharatMLStack/inferflow/v1.0.0/architecture" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Inferflow","item":"https://meesho.github.io/BharatMLStack/category/inferflow"},{"@type":"ListItem","position":2,"name":"v1.0.0","item":"https://meesho.github.io/BharatMLStack/inferflow/v1.0.0"},{"@type":"ListItem","position":3,"name":"Architecture","item":"https://meesho.github.io/BharatMLStack/inferflow/v1.0.0/architecture"}]}</script><link rel="alternate" type="application/rss+xml" href="/BharatMLStack/blog/rss.xml" title="BharatMLStack RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/BharatMLStack/blog/atom.xml" title="BharatMLStack Atom Feed"><link rel="stylesheet" href="/BharatMLStack/assets/css/styles.aaf16941.css">
<script src="/BharatMLStack/assets/js/runtime~main.52243414.js" defer="defer"></script>
<script src="/BharatMLStack/assets/js/main.391e8e6d.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div class="gradient-bg-global"><div class="gradient-orb-global orb-global-1"></div><div class="gradient-orb-global orb-global-2"></div><div class="gradient-orb-global orb-global-3"></div></div><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/BharatMLStack/"><b class="navbar__title text--truncate">BharatMLStack</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/BharatMLStack/intro">Docs</a><a class="navbar__item navbar__link" href="/BharatMLStack/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/Meesho/BharatMLStack" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/BharatMLStack/intro">BharatMLStack Documentation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/BharatMLStack/category/online-feature-store">Online Feature Store</a><button aria-label="Expand sidebar category &#x27;Online Feature Store&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/BharatMLStack/category/inferflow">Inferflow</a><button aria-label="Collapse sidebar category &#x27;Inferflow&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/BharatMLStack/inferflow/v1.0.0">v1.0.0</a><button aria-label="Collapse sidebar category &#x27;v1.0.0&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/BharatMLStack/inferflow/v1.0.0/architecture">Architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/BharatMLStack/inferflow/v1.0.0/functionalities">Key Functionalities</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/BharatMLStack/inferflow/v1.0.0/configuration">Configuration Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/BharatMLStack/inferflow/v1.0.0/release-notes">Release Notes</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/BharatMLStack/category/quick-start">Quick Start</a><button aria-label="Expand sidebar category &#x27;Quick Start&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/BharatMLStack/category/trufflebox-ui">Trufflebox UI</a><button aria-label="Expand sidebar category &#x27;Trufflebox UI&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/BharatMLStack/category/sdks">SDKs</a><button aria-label="Expand sidebar category &#x27;SDKs&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/BharatMLStack/category/skye">Skye</a><button aria-label="Expand sidebar category &#x27;Skye&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/BharatMLStack/category/numerix">Numerix</a><button aria-label="Expand sidebar category &#x27;Numerix&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/BharatMLStack/category/predator">Predator</a><button aria-label="Expand sidebar category &#x27;Predator&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/BharatMLStack/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/BharatMLStack/category/inferflow"><span>Inferflow</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/BharatMLStack/inferflow/v1.0.0"><span>v1.0.0</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Architecture</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>BharatMLStack - Inferflow</h1></header>
<p>Inferflow is part of <strong>BharatMLStack</strong>, a graph-driven feature retrieval and model inference orchestration engine built in <strong>Go</strong>. It eliminates the need for custom feature retrieval code by using configurable DAG topologies to dynamically resolve entity relationships, fetch features from the Online Feature Store, and orchestrate model scoring — all driven by configuration stored in <strong>etcd</strong>.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<p>In a typical ML serving pipeline, every new model requires bespoke code to:</p>
<ul>
<li>Fetch features from multiple entities (user, product, user x category, etc.)</li>
<li>Infer intermediate entity relationships (e.g., extract category from product to fetch user x category data)</li>
<li>Orchestrate one or more model inference calls</li>
<li>Handle I/O, batching, and error propagation</li>
</ul>
<p>Inferflow abstracts all of this behind a <strong>config-driven DAG executor</strong>. Given a <code>model_config_id</code> and context entities (e.g., <code>userId</code>, <code>productIds</code>), it:</p>
<ol>
<li>Loads a pre-defined feature retrieval and inference graph from etcd</li>
<li>Executes the graph to resolve entity relationships dynamically</li>
<li>Retrieves features from the Online Feature Store (OnFS) in parallel</li>
<li>Calls model serving endpoints (Predator) and compute services (Numerix)</li>
<li>Returns scored results as a structured response</li>
</ol>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="high-level-architecture">High-Level Architecture<a href="#high-level-architecture" class="hash-link" aria-label="Direct link to High-Level Architecture" title="Direct link to High-Level Architecture">​</a></h2>
<p><img decoding="async" loading="lazy" alt="Inferflow Architecture - DAG Topology Executor" src="/BharatMLStack/assets/images/v1.0.0-inferflow-arch-bce54b3b4f7d3be68fa22dc204529f53.png" width="2036" height="1212" class="img_ev3q"></p>
<p>The diagram shows the internal DAG structure of Inferflow&#x27;s topology executor. gRPC APIs (Pair, Point, Slate) feed into the DAG, where <strong>Feature Init</strong> bootstraps the ComponentMatrix. Feature components (FS User, FS Product, FS Region, FS User Cat, FS Region Scat) fetch features from <strong>OnFS</strong> in parallel and populate columns in the shared <strong>2D Result Matrix</strong>. Model components (Model A, Model B) call <strong>Predator</strong> for inference, and compute components call <strong>Numerix</strong> for operations like reranking. The entire DAG topology is driven by config loaded from <strong>etcd</strong>.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="core-components">Core Components<a href="#core-components" class="hash-link" aria-label="Direct link to Core Components" title="Direct link to Core Components">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-grpc-server">1. gRPC Server<a href="#1-grpc-server" class="hash-link" aria-label="Direct link to 1. gRPC Server" title="Direct link to 1. gRPC Server">​</a></h3>
<p>Inferflow exposes its APIs via a gRPC server, with HTTP health endpoints multiplexed on the same port using <strong>cmux</strong>. The server provides:</p>
<ul>
<li><strong>Inferflow API</strong> — <code>RetrieveModelScore</code>: entity-based feature retrieval and scoring</li>
<li><strong>Predict API</strong> — <code>InferPointWise</code>, <code>InferPairWise</code>, <code>InferSlateWise</code>: structured inference with targets, pairs, and slates</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-dag-topology-executor">2. DAG Topology Executor<a href="#2-dag-topology-executor" class="hash-link" aria-label="Direct link to 2. DAG Topology Executor" title="Direct link to 2. DAG Topology Executor">​</a></h3>
<p>The heart of Inferflow. Each model configuration defines a <code>component_dependency</code> map that describes a Directed Acyclic Graph (DAG) of components.</p>
<p><strong>Execution model:</strong></p>
<ul>
<li>Uses <strong>Kahn&#x27;s algorithm</strong> for topological ordering</li>
<li>Components at the same level run <strong>concurrently</strong> in goroutines</li>
<li>All components share a mutable <code>ComponentMatrix</code> (rows = entity IDs, columns = features/scores)</li>
<li>DAG topologies are <strong>cached</strong> using Murmur3 hashing with Ristretto cache</li>
</ul>
<p><strong>Validation:</strong></p>
<ul>
<li>Cycle detection via in-degree analysis</li>
<li>Component existence verification against the <code>ComponentProvider</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-component-types">3. Component Types<a href="#3-component-types" class="hash-link" aria-label="Direct link to 3. Component Types" title="Direct link to 3. Component Types">​</a></h3>
<p>Inferflow defines four types of DAG components:</p>
<table><thead><tr><th>Component</th><th>Role</th><th>External Dependency</th></tr></thead><tbody><tr><td><strong>FeatureInitComponent</strong></td><td>Root node — initializes the <code>ComponentMatrix</code> with entity IDs and schema</td><td>None</td></tr><tr><td><strong>FeatureComponent</strong></td><td>Fetches features from the Online Feature Store for a specific entity type</td><td>OnFS (gRPC)</td></tr><tr><td><strong>PredatorComponent</strong></td><td>Calls model serving endpoints for inference scoring</td><td>Predator / Helix (gRPC)</td></tr><tr><td><strong>NumerixComponent</strong></td><td>Calls compute engine for operations like reranking</td><td>Numerix (gRPC)</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-componentmatrix--the-2d-result-matrix">4. ComponentMatrix — The 2D Result Matrix<a href="#4-componentmatrix--the-2d-result-matrix" class="hash-link" aria-label="Direct link to 4. ComponentMatrix — The 2D Result Matrix" title="Direct link to 4. ComponentMatrix — The 2D Result Matrix">​</a></h3>
<p>The ComponentMatrix is a shared, mutable 2D data structure that flows through the entire DAG. Every component reads from and writes to this matrix, progressively building a complete feature + score row for each entity.</p>
<p><img decoding="async" loading="lazy" alt="DAG Execution &amp;amp; 2D Matrix Flow" src="/BharatMLStack/assets/images/v1.0.0-inferflow-dag-matrix-0f13b51422587e6099cf4ee783844db1.png" width="672" height="778" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="how-the-matrix-evolves-through-the-dag">How the matrix evolves through the DAG<a href="#how-the-matrix-evolves-through-the-dag" class="hash-link" aria-label="Direct link to How the matrix evolves through the DAG" title="Direct link to How the matrix evolves through the DAG">​</a></h4>
<p>The diagram above illustrates the three execution phases and how the 2D matrix grows at each stage:</p>
<p><strong>Phase 1 — Feature Retrieval</strong></p>
<p>The <strong>init</strong> node creates an empty matrix with one row per target entity ID. Feature components then execute — first the top-level entities (entity A, entity B) fetch their features from OnFS and populate their columns (shown as colored blocks). Derived entities (entity C, D, E) resolve their keys from the already-populated columns and add more feature columns. At this point the matrix contains all feature data, with each color representing features from a different entity.</p>
<p>The right side of the diagram shows the matrix being <strong>decomposed</strong> — feature columns from different entities are separated into per-model input groups, selecting only the features each model needs.</p>
<p><strong>Phase 2 — Model Invocation</strong></p>
<p>Model X and Model Y each receive their decomposed feature slices, call <strong>Predator</strong> for inference, and write score columns back into the matrix (shown as new colored columns appended to the right). Multiple models can run in parallel if they don&#x27;t depend on each other&#x27;s outputs.</p>
<p>The scores are then decomposed again to prepare inputs for the compute stage.</p>
<p><strong>Phase 3 — Numerix Compute</strong></p>
<p>The <strong>Score Comb</strong> node takes score columns from both models, calls <strong>Numerix</strong> for a final compute operation (e.g., score combination, reranking), and writes the final score column (shown in dark red) into the matrix. The result is a complete row per entity with all features and all scores.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="matrix-structure">Matrix structure<a href="#matrix-structure" class="hash-link" aria-label="Direct link to Matrix structure" title="Direct link to Matrix structure">​</a></h4>
<table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td><strong>Rows</strong></td><td>One per target entity ID (e.g., each product being scored)</td></tr><tr><td><strong>String columns</strong></td><td>Human-readable values used in responses</td></tr><tr><td><strong>Byte columns</strong></td><td>Binary-encoded feature values used for model inputs</td></tr><tr><td><strong>Column naming</strong></td><td><code>entity_label:feature_group:feature_name</code></td></tr></tbody></table>
<p>Each component only reads the columns it needs and writes to its own columns, enabling safe concurrent execution across independent branches of the DAG.</p>
<p>For slate-based APIs, a companion <code>SlateData</code> structure holds per-slate matrices and scores, with <code>slate_target_indices</code> mapping slates to rows in the main matrix.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-configuration-management-etcd">5. Configuration Management (etcd)<a href="#5-configuration-management-etcd" class="hash-link" aria-label="Direct link to 5. Configuration Management (etcd)" title="Direct link to 5. Configuration Management (etcd)">​</a></h3>
<p>Model configurations are stored in etcd and hot-reloaded via watchers:</p>
<ul>
<li><strong>Config paths</strong>: <code>/config/inferflow/services/</code>, <code>/model-config</code></li>
<li><strong>Watch mechanism</strong>: etcd watchers trigger <code>ReloadModelConfigMapAndRegisterComponents</code> on any change</li>
<li><strong>On reload</strong>: Updates <code>ConfigMap</code>, re-initializes feature schemas, and re-registers DAG components</li>
</ul>
<p>This means new models or configuration changes go live <strong>without redeployment</strong>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-external-integrations">6. External Integrations<a href="#6-external-integrations" class="hash-link" aria-label="Direct link to 6. External Integrations" title="Direct link to 6. External Integrations">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="online-feature-store-onfs">Online Feature Store (OnFS)<a href="#online-feature-store-onfs" class="hash-link" aria-label="Direct link to Online Feature Store (OnFS)" title="Direct link to Online Feature Store (OnFS)">​</a></h4>
<ul>
<li>gRPC client calling <code>FeatureService.RetrieveFeatures</code></li>
<li>Batched retrieval with configurable batch size and deadline</li>
<li>Auth via <code>CALLER_ID</code> and <code>CALLER_TOKEN</code> metadata</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="predator-model-serving">Predator (Model Serving)<a href="#predator-model-serving" class="hash-link" aria-label="Direct link to Predator (Model Serving)" title="Direct link to Predator (Model Serving)">​</a></h4>
<ul>
<li>Uses <code>go-sdk</code> for model inference</li>
<li>Supports <strong>percentage-based traffic routing</strong> across multiple model endpoints</li>
<li>Configurable calibration and batch sizing</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="numerix-compute-engine">Numerix (Compute Engine)<a href="#numerix-compute-engine" class="hash-link" aria-label="Direct link to Numerix (Compute Engine)" title="Direct link to Numerix (Compute Engine)">​</a></h4>
<ul>
<li>Uses <code>go-sdk</code> Numerix client</li>
<li>RPC: <code>NumerixService.Compute</code> with entity score data</li>
<li>Used for compute operations like reranking</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="kafka-inference-logging">Kafka (Inference Logging)<a href="#kafka-inference-logging" class="hash-link" aria-label="Direct link to Kafka (Inference Logging)" title="Direct link to Kafka (Inference Logging)">​</a></h4>
<ul>
<li>Async inference log publishing using <code>segmentio/kafka-go</code></li>
<li>Supports <strong>Proto</strong>, <strong>Arrow</strong>, and <strong>Parquet</strong> serialization formats</li>
<li>Configurable sampling via <code>LoggingPerc</code> and user-based daily sampling</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="request-flow">Request Flow<a href="#request-flow" class="hash-link" aria-label="Direct link to Request Flow" title="Direct link to Request Flow">​</a></h2>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">1. Client sends gRPC request with model_config_id + entity IDs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2. Load ModelConfig from etcd-backed ConfigMap</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">3. Adapt proto request → ComponentRequest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   (build ComponentMatrix with entity schema)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">4. Resolve DAG topology from component_dependency config</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">5. Execute DAG (Kahn&#x27;s algorithm, concurrent):</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   ├─ FeatureInitComponent: populate matrix with entity IDs + schema</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   ├─ FeatureComponents (parallel): fetch features from OnFS → fill matrix columns</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   ├─ PredatorComponent: build feature payloads from matrix → call model → write scores</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   └─ NumerixComponent: read scores from matrix → call compute → write final scores</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">6. Build response from matrix columns per ResponseConfig</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">7. (Optional) Async Kafka logging of inference features and scores</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">8. Return gRPC response to client</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="observability">Observability<a href="#observability" class="hash-link" aria-label="Direct link to Observability" title="Direct link to Observability">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="metrics-statsd--telegraf">Metrics (StatsD / Telegraf)<a href="#metrics-statsd--telegraf" class="hash-link" aria-label="Direct link to Metrics (StatsD / Telegraf)" title="Direct link to Metrics (StatsD / Telegraf)">​</a></h3>
<table><thead><tr><th>Metric</th><th>Description</th></tr></thead><tbody><tr><td><code>inferflow.retrievemodelscore.request.total</code></td><td>Total RetrieveModelScore requests</td></tr><tr><td><code>inferflow.retrievemodelscore.latency</code></td><td>End-to-end latency</td></tr><tr><td><code>inferflow.retrievemodelscore.batch.size</code></td><td>Batch size per request</td></tr><tr><td><code>predict.infer.request.total</code></td><td>Total Predict API requests</td></tr><tr><td><code>predict.infer.latency</code></td><td>Predict API latency</td></tr><tr><td><code>inferflow.component.execution.total</code></td><td>Per-component execution count</td></tr><tr><td><code>inferflow.component.execution.latency</code></td><td>Per-component latency</td></tr><tr><td><code>inferflow.component.execution.error</code></td><td>Component-level errors</td></tr><tr><td><code>inferflow.component.feature.count</code></td><td>Feature count per component</td></tr><tr><td><code>inferflow.external.api.request.total</code></td><td>External API call count</td></tr><tr><td><code>inferflow.external.api.latency</code></td><td>External API latency</td></tr><tr><td><code>inferflow.component.inmemorycache.request.total</code></td><td>Cache hit/miss total</td></tr><tr><td><code>inferflow.component.inmemorycache.miss</code></td><td>Cache misses</td></tr><tr><td><code>inferflow.logging.kafka_sent</code></td><td>Kafka log messages sent</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="logging">Logging<a href="#logging" class="hash-link" aria-label="Direct link to Logging" title="Direct link to Logging">​</a></h3>
<ul>
<li>Structured JSON logging via <strong>zerolog</strong></li>
<li>Configurable log levels</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="deployment">Deployment<a href="#deployment" class="hash-link" aria-label="Direct link to Deployment" title="Direct link to Deployment">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="docker">Docker<a href="#docker" class="hash-link" aria-label="Direct link to Docker" title="Direct link to Docker">​</a></h3>
<p>Inferflow ships as a multi-stage Docker image:</p>
<ul>
<li><strong>Builder</strong>: Go 1.19 Alpine with optional Kafka support (librdkafka)</li>
<li><strong>Runtime</strong>: Debian 10 slim</li>
<li><strong>Build command</strong>: <code>go build -tags musl -ldflags &quot;-extldflags -static&quot; -o server cmd/${module}/main.go</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="supported-environments">Supported Environments<a href="#supported-environments" class="hash-link" aria-label="Direct link to Supported Environments" title="Direct link to Supported Environments">​</a></h3>
<ul>
<li>Kubernetes (K8s)</li>
<li>Google Kubernetes Engine (GKE)</li>
<li>Amazon EKS</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuration">Configuration<a href="#configuration" class="hash-link" aria-label="Direct link to Configuration" title="Direct link to Configuration">​</a></h3>
<p>All configuration is driven via environment variables (loaded by Viper) and etcd. No config files are required at deployment time.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="target-users">Target Users<a href="#target-users" class="hash-link" aria-label="Direct link to Target Users" title="Direct link to Target Users">​</a></h2>
<table><thead><tr><th>User</th><th>Role</th></tr></thead><tbody><tr><td>Data Scientists</td><td>Define model configs and feature retrieval graphs via config — no code needed</td></tr><tr><td>ML Engineers</td><td>Onboard new models by updating etcd config; manage DAG topologies</td></tr><tr><td>Backend Developers</td><td>Integrate via gRPC SDKs for real-time scoring in application services</td></tr><tr><td>Platform Engineers</td><td>Deploy, scale, and monitor Inferflow clusters</td></tr></tbody></table>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="benefits">Benefits<a href="#benefits" class="hash-link" aria-label="Direct link to Benefits" title="Direct link to Benefits">​</a></h2>
<ul>
<li><strong>No-code feature retrieval</strong> — new models need only a config change, not custom code</li>
<li><strong>Feature consistency</strong> — same graph-driven retrieval ensures identical features across experiments</li>
<li><strong>Faster iteration</strong> — experiment with new models in minutes, not days</li>
<li><strong>Concurrent execution</strong> — DAG components run in parallel for minimal latency</li>
<li><strong>Hot reloading</strong> — model config changes via etcd go live without redeployment</li>
<li><strong>Multi-API support</strong> — PointWise, PairWise, and SlateWise inference patterns out of the box</li>
<li><strong>Production-grade</strong> — built in Go with gRPC, designed for millions of QPS</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="contributing">Contributing<a href="#contributing" class="hash-link" aria-label="Direct link to Contributing" title="Direct link to Contributing">​</a></h2>
<p>We welcome contributions from the community! Please see our <a href="https://github.com/Meesho/BharatMLStack/blob/main/CONTRIBUTING.md" target="_blank" rel="noopener noreferrer">Contributing Guide</a> for details on how to get started.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="community--support">Community &amp; Support<a href="#community--support" class="hash-link" aria-label="Direct link to Community &amp; Support" title="Direct link to Community &amp; Support">​</a></h2>
<ul>
<li><strong>Discord</strong>: Join our <a href="https://discord.gg/XkT7XsV2AU" target="_blank" rel="noopener noreferrer">community chat</a></li>
<li><strong>Issues</strong>: Report bugs and request features on <a href="https://github.com/Meesho/BharatMLStack/issues" target="_blank" rel="noopener noreferrer">GitHub Issues</a></li>
<li><strong>Email</strong>: Contact us at <a href="mailto:ml-oss@meesho.com" target="_blank" rel="noopener noreferrer">ml-oss@meesho.com</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="license">License<a href="#license" class="hash-link" aria-label="Direct link to License" title="Direct link to License">​</a></h2>
<p>BharatMLStack is open-source software licensed under the <a href="https://github.com/Meesho/BharatMLStack/blob/main/LICENSE.md" target="_blank" rel="noopener noreferrer">BharatMLStack Business Source License 1.1</a>.</p>
<hr>
<div align="center"><strong>Built with ❤️ for the ML community from Meesho</strong></div>
<div align="center"><strong>If you find this useful, ⭐️ the repo — your support means the world to us!</strong></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/Meesho/BharatMLStack/tree/main/docs/docs/inferflow/v1.0.0/architecture.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/BharatMLStack/inferflow/v1.0.0"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">v1.0.0</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/BharatMLStack/inferflow/v1.0.0/functionalities"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Key Functionalities</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#high-level-architecture" class="table-of-contents__link toc-highlight">High-Level Architecture</a></li><li><a href="#core-components" class="table-of-contents__link toc-highlight">Core Components</a><ul><li><a href="#1-grpc-server" class="table-of-contents__link toc-highlight">1. gRPC Server</a></li><li><a href="#2-dag-topology-executor" class="table-of-contents__link toc-highlight">2. DAG Topology Executor</a></li><li><a href="#3-component-types" class="table-of-contents__link toc-highlight">3. Component Types</a></li><li><a href="#4-componentmatrix--the-2d-result-matrix" class="table-of-contents__link toc-highlight">4. ComponentMatrix — The 2D Result Matrix</a></li><li><a href="#5-configuration-management-etcd" class="table-of-contents__link toc-highlight">5. Configuration Management (etcd)</a></li><li><a href="#6-external-integrations" class="table-of-contents__link toc-highlight">6. External Integrations</a></li></ul></li><li><a href="#request-flow" class="table-of-contents__link toc-highlight">Request Flow</a></li><li><a href="#observability" class="table-of-contents__link toc-highlight">Observability</a><ul><li><a href="#metrics-statsd--telegraf" class="table-of-contents__link toc-highlight">Metrics (StatsD / Telegraf)</a></li><li><a href="#logging" class="table-of-contents__link toc-highlight">Logging</a></li></ul></li><li><a href="#deployment" class="table-of-contents__link toc-highlight">Deployment</a><ul><li><a href="#docker" class="table-of-contents__link toc-highlight">Docker</a></li><li><a href="#supported-environments" class="table-of-contents__link toc-highlight">Supported Environments</a></li><li><a href="#configuration" class="table-of-contents__link toc-highlight">Configuration</a></li></ul></li><li><a href="#target-users" class="table-of-contents__link toc-highlight">Target Users</a></li><li><a href="#benefits" class="table-of-contents__link toc-highlight">Benefits</a></li><li><a href="#contributing" class="table-of-contents__link toc-highlight">Contributing</a></li><li><a href="#community--support" class="table-of-contents__link toc-highlight">Community &amp; Support</a></li><li><a href="#license" class="table-of-contents__link toc-highlight">License</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/Meesho/BharatMLStack/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github Discussions<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://discord.gg/XkT7XsV2AU" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/BharatMLStack/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/Meesho/BharatMLStack" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 Meesho Ltd. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>