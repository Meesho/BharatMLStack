"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1508],{3257:(e,n,i)=>{i.d(n,{A:()=>r});const r=i.p+"assets/images/skye-rt-consumer-flow-7f064a31c41151ff4516900b3170dbc8.png"},8453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>d});var r=i(6540);const s={},t=r.createContext(s);function a(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),r.createElement(t.Provider,{value:n},e.children)}},9312:(e,n,i)=>{i.d(n,{A:()=>r});const r=i.p+"assets/images/skye-system-overview-24940f4c319f41fb3b7583a525b0a534.png"},9390:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"skye/v1.0.0/architecture","title":"Architecture","description":"Skye is BharatMLStack\'s vector similarity search platform that enables fast semantic retrieval by representing data as vectors and querying nearest matches in high-dimensional space. It is composed of three runnable components: skye-admin, skye-consumers, and skye-serving.","source":"@site/docs/skye/v1.0.0/architecture.md","sourceDirName":"skye/v1.0.0","slug":"/skye/v1.0.0/architecture","permalink":"/BharatMLStack/skye/v1.0.0/architecture","draft":false,"unlisted":false,"editUrl":"https://github.com/Meesho/BharatMLStack/tree/main/docs/docs/skye/v1.0.0/architecture.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"Architecture","sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"v1.0.0","permalink":"/BharatMLStack/skye/v1.0.0"},"next":{"title":"Functionalities","permalink":"/BharatMLStack/skye/v1.0.0/functionalities"}}');var s=i(4848),t=i(8453);const a={title:"Architecture",sidebar_position:1},d="Skye - Vector Similarity Search Platform",l={},c=[{value:"System Overview",id:"system-overview",level:2},{value:"Component Architecture",id:"component-architecture",level:3},{value:"Data Model",id:"data-model",level:2},{value:"Model and Variant Hierarchy",id:"model-and-variant-hierarchy",level:3},{value:"Entity-Based Data Split",id:"entity-based-data-split",level:3},{value:"Serving Flow",id:"serving-flow",level:2},{value:"Configuration Bootstrap",id:"configuration-bootstrap",level:3},{value:"Admin Flows",id:"admin-flows",level:2},{value:"API Contracts",id:"api-contracts",level:3},{value:"Register Model",id:"register-model",level:4},{value:"Register Variant",id:"register-variant",level:4},{value:"Reset Model",id:"reset-model",level:4},{value:"Trigger Model Machine",id:"trigger-model-machine",level:4},{value:"Promote Model / Variant to Scale-Up Cluster",id:"promote-model--variant-to-scale-up-cluster",level:4},{value:"Consumer Flows",id:"consumer-flows",level:2},{value:"Reset/Delta Ingestion",id:"resetdelta-ingestion",level:3},{value:"Real-Time Consumers",id:"real-time-consumers",level:3},{value:"Retry Topic",id:"retry-topic",level:3},{value:"Key Design Decisions",id:"key-design-decisions",level:2},{value:"Pluggable Vector Database Support",id:"pluggable-vector-database-support",level:3},{value:"Variant-Based Model Sharing",id:"variant-based-model-sharing",level:3},{value:"ScyllaDB for Real-Time Aggregation",id:"scylladb-for-real-time-aggregation",level:3},{value:"Event-Driven State Management",id:"event-driven-state-management",level:3},{value:"Resiliency",id:"resiliency",level:2},{value:"Scalability",id:"scalability",level:2},{value:"Observability",id:"observability",level:2},{value:"Metrics (per model + variant)",id:"metrics-per-model--variant",level:3},{value:"Alerts",id:"alerts",level:3},{value:"Technology Stack",id:"technology-stack",level:2}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"skye---vector-similarity-search-platform",children:"Skye - Vector Similarity Search Platform"})}),"\n",(0,s.jsxs)(n.p,{children:["Skye is BharatMLStack's vector similarity search platform that enables fast semantic retrieval by representing data as vectors and querying nearest matches in high-dimensional space. It is composed of three runnable components: ",(0,s.jsx)(n.strong,{children:"skye-admin"}),", ",(0,s.jsx)(n.strong,{children:"skye-consumers"}),", and ",(0,s.jsx)(n.strong,{children:"skye-serving"}),"."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"system-overview",children:"System Overview"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Skye System Architecture",src:i(9312).A+"",width:"1276",height:"870"})}),"\n",(0,s.jsx)(n.p,{children:"Skye provides a critical platform for managing data aggregation, model onboarding, and embedding support at production scale. The architecture is designed around three core pillars:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Pluggable Vector Databases"}),": Support for multiple vector database backends (Qdrant and extensible to others) via a generic abstraction layer."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Tenant-Level Index Isolation with Shared Embeddings"}),": Models are stored once but can serve multiple tenants (variants), reducing data redundancy."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Event-Driven Administration"}),": Model lifecycle management is handled through Kafka-based event flows for resilience and fault tolerance."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"component-architecture",children:"Component Architecture"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Component"}),(0,s.jsx)(n.th,{children:"Role"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"skye-serving"})}),(0,s.jsx)(n.td,{children:"Handles real-time similarity search queries with in-memory caching and vector DB lookups"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"skye-consumers"})}),(0,s.jsx)(n.td,{children:"Processes embedding ingestion (reset/delta jobs) and real-time aggregation events from Kafka"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"skye-admin"})}),(0,s.jsx)(n.td,{children:"Manages model lifecycle, onboarding, variant registration, and coordinates Databricks jobs"})]})]})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"data-model",children:"Data Model"}),"\n",(0,s.jsx)(n.h3,{id:"model-and-variant-hierarchy",children:"Model and Variant Hierarchy"}),"\n",(0,s.jsxs)(n.p,{children:["Skye uses a ",(0,s.jsx)(n.strong,{children:"model-first"})," hierarchy rather than a tenant-first approach. Models sit at the base level with variants (formerly tenants) nested within each model. This eliminates embedding duplication across tenants."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"model (e.g., intent_model)\n  \u251c\u2500\u2500 model_config (distance_function, vector_dimension, etc.)\n  \u251c\u2500\u2500 embedding_store (shared embeddings for all variants)\n  \u251c\u2500\u2500 variant_1 (e.g., organic)\n  \u2502   \u251c\u2500\u2500 vss_filter (criteria for index inclusion)\n  \u2502   \u251c\u2500\u2500 vectordb_type (QDRANT, etc.)\n  \u2502   \u251c\u2500\u2500 vectordb_config (host, port, replication, sharding)\n  \u2502   \u251c\u2500\u2500 read_version / write_version\n  \u2502   \u2514\u2500\u2500 job_frequency (FREQ_1D, FREQ_3H, etc.)\n  \u2514\u2500\u2500 variant_2 (e.g., ad)\n      \u251c\u2500\u2500 vss_filter\n      \u251c\u2500\u2500 vectordb_type\n      \u2514\u2500\u2500 ...\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Key benefit"}),": If a model consumes 30M embeddings and is used by two variants, the embeddings are stored once (30M) instead of duplicated (60M)."]}),"\n",(0,s.jsx)(n.h3,{id:"entity-based-data-split",children:"Entity-Based Data Split"}),"\n",(0,s.jsx)(n.p,{children:"Data is split at the entity level (catalog, product, user) into separate tables for both embeddings and aggregator data:"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Embedding Tables"})," (per entity):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE catalog_embeddings (\n    model_name text,\n    version int,\n    id text,\n    embedding frozen<list<decimal>>,\n    search_embedding frozen<list<decimal>>,\n    to_be_indexed_variant_1 boolean,\n    to_be_indexed_variant_2 boolean,\n    PRIMARY KEY ((model_name, version), id)\n);\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Aggregator Tables"})," (per entity):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE catalog_aggregator (\n    id text,\n    is_live_ad text,\n    out_of_stock text,\n    PRIMARY KEY (id)\n);\n"})}),"\n",(0,s.jsx)(n.p,{children:"Each entity is mapped via a store configuration:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n    "db_conf_id": "1",\n    "embeddings_table": "catalog_embeddings",\n    "aggregator_table": "catalog_aggregator"\n}\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"serving-flow",children:"Serving Flow"}),"\n",(0,s.jsx)(n.p,{children:"The serving path is optimized for low latency with multiple caching layers:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Request arrives"})," at skye-serving via gRPC"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"ConfigRepo"})," resolves the model configuration, variant filters, and vector DB connection"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"In-memory cache"})," is checked first to reduce load on distributed cache"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Distributed cache (Redis)"})," is checked next for cached similarity results"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Vector DB query"})," executes if cache misses, using ",(0,s.jsx)(n.code,{children:"search_indexed_only"})," flag for optimal searches within indexed space"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Aggregator data"})," is fetched from ScyllaDB to apply variant-level filters"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Response"})," returns ranked similar candidates with scores"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"configuration-bootstrap",children:"Configuration Bootstrap"}),"\n",(0,s.jsx)(n.p,{children:"On startup, ConfigRepo creates:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"A map of each model with its configurations (embedding table, vector DB channel)"}),"\n",(0,s.jsx)(n.li,{children:"A map of each entity to its aggregator table"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n    "intent_model": {\n        "db_conf_id": "1",\n        "index_embedding_table": "catalog_embeddings",\n        "vector_db_grpc_channel": "<grpc_channel_info>"\n    }\n}\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"admin-flows",children:"Admin Flows"}),"\n",(0,s.jsxs)(n.p,{children:["Skye uses an ",(0,s.jsx)(n.strong,{children:"event-driven approach"})," for model lifecycle management:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"All admin operations are processed through Kafka consumers asynchronously"}),"\n",(0,s.jsx)(n.li,{children:"A SQL database behind the admin stores all model states"}),"\n",(0,s.jsx)(n.li,{children:"Pod termination does not affect in-progress operations (events are re-consumed on failure)"}),"\n",(0,s.jsx)(n.li,{children:"Databricks jobs are triggered and monitored via the admin API"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"api-contracts",children:"API Contracts"}),"\n",(0,s.jsx)(n.h4,{id:"register-model",children:"Register Model"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"POST /register-model\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n    "entity": "catalog",\n    "ingestion_column_mapping": "{\\"id_column\\":\\"id\\",\\"embedding_column\\":\\"features\\",\\"to_be_indexed_column\\":\\"to_be_indexed\\"}",\n    "embedding_store_enabled": true,\n    "embedding_store_ttl": 604800,\n    "mq_id": 804,\n    "model_config": "{\\"distance_function\\":\\"DOT\\",\\"vector_dimension\\":32}",\n    "store_id": 1,\n    "training_data_path": "gcs_path"\n}\n'})}),"\n",(0,s.jsx)(n.h4,{id:"register-variant",children:"Register Variant"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"POST /register-variant\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n    "entity": "catalog",\n    "model_name": "intent_model",\n    "vss_filter": "{...filter criteria...}",\n    "vectordb_type": "QDRANT",\n    "vectordb_config": "{...connection config...}",\n    "job_frequency": "FREQ_1D"\n}\n'})}),"\n",(0,s.jsx)(n.h4,{id:"reset-model",children:"Reset Model"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"POST /reset-model\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n    "entity": "catalog",\n    "model_name": "intent_model",\n    "frequency": "FREQ_1D"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Response includes variant version mappings, MQ ID, and training data path for the Databricks job."}),"\n",(0,s.jsx)(n.h4,{id:"trigger-model-machine",children:"Trigger Model Machine"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"POST /trigger-model-machine\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n    "entity": "catalog",\n    "model_name": "intent_model",\n    "variant": "organic"\n}\n'})}),"\n",(0,s.jsx)(n.h4,{id:"promote-model--variant-to-scale-up-cluster",children:"Promote Model / Variant to Scale-Up Cluster"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"POST /promote-model\nPOST /promote-variant\n"})}),"\n",(0,s.jsx)(n.p,{children:"Used to transition successful experiments from experiment clusters to production clusters."}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"consumer-flows",children:"Consumer Flows"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Skye Real-Time Consumer Flow",src:i(3257).A+"",width:"1192",height:"960"})}),"\n",(0,s.jsx)(n.h3,{id:"resetdelta-ingestion",children:"Reset/Delta Ingestion"}),"\n",(0,s.jsx)(n.p,{children:"Embedding ingestion occurs once per model and executes in parallel for each variant. The Kafka event contract supports:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Multiple variants per event"}),": A single embedding event specifies which variants should index the data"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Separate search and index embeddings"}),": Models can have different embeddings for search space vs index space"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"EOF handling"}),": EOF is sent to all partitions to ensure all data is consumed before completion"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n    "entity": "catalog",\n    "model_name": "intent_model",\n    "candidate_id": "48869419",\n    "version": "1",\n    "index_space": {\n        "variants_version_map": "{\'organic\':1,\'ad\':2}",\n        "embedding": [0.036, -0.048, ...],\n        "variants_index_map": "{\'organic\':true,\'ad\':false}",\n        "operation": "A",\n        "payload": "{\'sscat_id\':700}"\n    },\n    "search_space": {\n        "embedding": [0.036, -0.048, ...]\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"real-time-consumers",children:"Real-Time Consumers"}),"\n",(0,s.jsx)(n.p,{children:"A generic Kafka schema is used for all real-time consumers, simplifying new integrations:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n    "timestamp": 1719308350,\n    "entity_label": "catalog",\n    "data": [\n        {\n            "id": "125138466",\n            "label": "is_live_ad",\n            "value": "true"\n        }\n    ]\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"retry-topic",children:"Retry Topic"}),"\n",(0,s.jsx)(n.p,{children:"Failed ingestion events are published to a retry topic for reprocessing, ensuring no data loss:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n    "timestamp": 1719308350,\n    "entity_label": "catalog",\n    "model_name": "intent_model",\n    "variant": "organic",\n    "data": [\n        {\n            "id": "125138466",\n            "label": "is_live_ad",\n            "value": "true"\n        }\n    ]\n}\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"key-design-decisions",children:"Key Design Decisions"}),"\n",(0,s.jsx)(n.h3,{id:"pluggable-vector-database-support",children:"Pluggable Vector Database Support"}),"\n",(0,s.jsxs)(n.p,{children:["Skye introduces a generic ",(0,s.jsx)(n.code,{children:"vector_db_type"})," configuration and converts vendor-specific configs to a generic ",(0,s.jsx)(n.code,{children:"vector_config"}),", enabling support for multiple vector database backends beyond Qdrant."]}),"\n",(0,s.jsx)(n.h3,{id:"variant-based-model-sharing",children:"Variant-Based Model Sharing"}),"\n",(0,s.jsx)(n.p,{children:"By eliminating the tenant-based construct and introducing variants, Skye allows:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Models to be shared across tenants without duplication"}),"\n",(0,s.jsx)(n.li,{children:"Each variant to have its own filter criteria, vector DB config, and job frequency"}),"\n",(0,s.jsx)(n.li,{children:"Independent read/write version tracking per variant"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"scylladb-for-real-time-aggregation",children:"ScyllaDB for Real-Time Aggregation"}),"\n",(0,s.jsx)(n.p,{children:"Replaced Delta Lake with self-hosted ScyllaDB for cost efficiency. The aggregator is entity-generic (not model/version-specific) since all real-time data is consistent across models."}),"\n",(0,s.jsx)(n.h3,{id:"event-driven-state-management",children:"Event-Driven State Management"}),"\n",(0,s.jsx)(n.p,{children:"Model state transitions are handled via Kafka events with a SQL database backing store. This eliminates:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Single points of failure in admin/ingestion flows"}),"\n",(0,s.jsx)(n.li,{children:"Models getting stuck during pod restarts"}),"\n",(0,s.jsx)(n.li,{children:"Manual intervention for consumer pause/resume"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"resiliency",children:"Resiliency"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Mechanism"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Retry Topics"})}),(0,s.jsx)(n.td,{children:"Failed ingestion messages are captured in a failure topic for reprocessing"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Circuit Breakers"})}),(0,s.jsx)(n.td,{children:"Applied to similarity search API calls to throttle RPS during failures"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Snapshot Backups"})}),(0,s.jsx)(n.td,{children:"Periodic collection snapshots enable quick restore during downtime"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Automated Cluster Setup"})}),(0,s.jsx)(n.td,{children:"Scripted provisioning eliminates configuration inconsistencies"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Databricks Job Retries"})}),(0,s.jsx)(n.td,{children:"Lambda functions with retry mechanisms for failed ingestion jobs"})]})]})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"scalability",children:"Scalability"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Vector DB Scaling"}),": Generic scripts for adding nodes to existing clusters, enabling horizontal scaling based on load and RPS"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Service Scaling"}),": Hosted on EKS with CPU-based autoscaling"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Experiment Isolation"}),": Experiments run on separate EKS and vector DB clusters, reducing production cluster complexity"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Indexed-Only Search"}),": The ",(0,s.jsx)(n.code,{children:"search_indexed_only"})," flag ensures queries only search indexed space, avoiding latency from brute-force searches on partially built indexes"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"observability",children:"Observability"}),"\n",(0,s.jsx)(n.h3,{id:"metrics-per-model--variant",children:"Metrics (per model + variant)"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Metric"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"avg_similar_candidates"})}),(0,s.jsx)(n.td,{children:"Average number of similarity candidates returned"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"avg_recall"})}),(0,s.jsx)(n.td,{children:"Score of the first similar catalog returned"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Service Latency"}),(0,s.jsx)(n.td,{children:"P99.9 / P99 / P95 / P50"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Service 5xx Count"}),(0,s.jsx)(n.td,{children:"Error rate monitoring"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Vector DB Latency"}),(0,s.jsx)(n.td,{children:"P99.9 / P99 / P95 / P50"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Vector DB QPS"}),(0,s.jsx)(n.td,{children:"Throughput monitoring"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"ScyllaDB Latency"}),(0,s.jsx)(n.td,{children:"P99.9 / P99 / P95 / P90"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Redis Latency"}),(0,s.jsx)(n.td,{children:"P99.9 / P99 / P95 / P90"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Redis Hit %"}),(0,s.jsx)(n.td,{children:"Cache effectiveness"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"alerts",children:"Alerts"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Alert"}),(0,s.jsx)(n.th,{children:"Threshold"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Indexed Vector Count"}),(0,s.jsx)(n.td,{children:"< 95%"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Events to Failure Topic"}),(0,s.jsx)(n.td,{children:"Rate > 0"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Service 5xx"}),(0,s.jsx)(n.td,{children:"< 10"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Service Latency"}),(0,s.jsx)(n.td,{children:"Model-dependent SLA"})]})]})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"technology-stack",children:"Technology Stack"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Component"}),(0,s.jsx)(n.th,{children:"Technology"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Language"}),(0,s.jsx)(n.td,{children:"Go"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Vector Database"}),(0,s.jsx)(n.td,{children:"Qdrant (pluggable)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Embedding Storage"}),(0,s.jsx)(n.td,{children:"ScyllaDB"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Real-Time Aggregation"}),(0,s.jsx)(n.td,{children:"ScyllaDB"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Caching"}),(0,s.jsx)(n.td,{children:"Redis + In-Memory"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Message Queue"}),(0,s.jsx)(n.td,{children:"Kafka"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Configuration"}),(0,s.jsx)(n.td,{children:"ZooKeeper / etcd"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Container Orchestration"}),(0,s.jsx)(n.td,{children:"Kubernetes (EKS)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Job Orchestration"}),(0,s.jsx)(n.td,{children:"Databricks"})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}}}]);